import React, { useRef, useState } from "react";
import styles from "./HomeImageUploadArea.module.css";

interface HomeImageUploadAreaProps {
  onImageSelect?: (file: File) => void;
  maxFileSize?: number; // in bytes
  acceptedFormats?: string[];
  onHelpClick?: () => void;
  showHelpButton?: boolean;
  onClickOverride?: (e?: React.MouseEvent) => void; // If provided, replaces default click behavior
}

export default function HomeImageUploadArea({
  onImageSelect,
  maxFileSize = 10 * 1024 * 1024, // 10MB default
  acceptedFormats = ["image/jpeg", "image/png", "image/jpg"],
  onHelpClick,
  showHelpButton = true,
  onClickOverride,
}: HomeImageUploadAreaProps) {
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [isDragging, setIsDragging] = useState(false);

  const handleFileSelect = (file: File) => {
    if (file.size > maxFileSize) {
      alert(`הקובץ גדול מדי. גודל מקסימלי: ${maxFileSize / 1024 / 1024}MB`);
      return;
    }

    if (!acceptedFormats.includes(file.type)) {
      alert("פורמט הקובץ לא נתמך. אנא העלה תמונה בפורמט JPG או PNG");
      return;
    }

    onImageSelect?.(file);
  };

  const handleFileInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      handleFileSelect(file);
    }
  };

  const handleClick = (e: React.MouseEvent) => {
    if (onClickOverride) {
      e.preventDefault();
      e.stopPropagation();
      onClickOverride(e);
      return;
    }
    fileInputRef.current?.click();
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(true);
  };

  const handleDragLeave = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);

    const file = e.dataTransfer.files?.[0];
    if (file) {
      handleFileSelect(file);
    }
  };

  return (
    <div
      className={`${styles.homeImageUploadArea} ${
        isDragging ? styles.dragging : ""
      }`}
      onClick={handleClick}
      onDragOver={handleDragOver}
      onDragLeave={handleDragLeave}
      onDrop={handleDrop}
    >
      <svg
        className={styles.borderSvg}
        viewBox="0 0 361 473"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        preserveAspectRatio="none"
        aria-hidden="true"
      >
        <path
          d="M339.75 0.75V0H337.258V0.75V1.5H339.75V0.75ZM332.273 0.75V0H327.289V0.75V1.5H332.273V0.75ZM322.305 0.75V0H317.32V0.75V1.5H322.305V0.75ZM312.336 0.75V0H307.352V0.75V1.5H312.336V0.75ZM302.367 0.75V0H297.383V0.75V1.5H302.367V0.75ZM292.398 0.75V0H287.414V0.75V1.5H292.398V0.75ZM282.43 0.75V0H277.445V0.75V1.5H282.43V0.75ZM272.461 0.75V0H267.477V0.75V1.5H272.461V0.75ZM262.492 0.75V0H257.508V0.75V1.5H262.492V0.75ZM252.523 0.75V0H247.539V0.75V1.5H252.523V0.75ZM242.555 0.75V0H237.57V0.75V1.5H242.555V0.75ZM232.586 0.75V0H227.602V0.75V1.5H232.586V0.75ZM222.617 0.75V0H217.633V0.75V1.5H222.617V0.75ZM212.648 0.75V0H207.664V0.75V1.5H212.648V0.75ZM202.68 0.75V0H197.695V0.75V1.5H202.68V0.75ZM192.711 0.75V0H187.727V0.75V1.5H192.711V0.75ZM182.742 0.75V0H177.758V0.75V1.5H182.742V0.75ZM172.773 0.75V0H167.789V0.75V1.5H172.773V0.75ZM162.805 0.75V0H157.82V0.75V1.5H162.805V0.75ZM152.836 0.75V0H147.852V0.75V1.5H152.836V0.75ZM142.867 0.75V0H137.883V0.75V1.5H142.867V0.75ZM132.898 0.75V0H127.914V0.75V1.5H132.898V0.75ZM122.93 0.75V0H117.945V0.75V1.5H122.93V0.75ZM112.961 0.75V0H107.977V0.75V1.5H112.961V0.75ZM102.992 0.75V0H98.0078V0.75V1.5H102.992V0.75ZM93.0234 0.75V0H88.0391V0.75V1.5H93.0234V0.75ZM83.0547 0.75V0H78.0703V0.75V1.5H83.0547V0.75ZM73.0859 0.75V0H68.1016V0.75V1.5H73.0859V0.75ZM63.1172 0.75V0H58.1328V0.75V1.5H63.1172V0.75ZM53.1484 0.75V0H48.1641V0.75V1.5H53.1484V0.75ZM43.1797 0.75V0H38.1953V0.75V1.5H43.1797V0.75ZM33.2109 0.75V0H28.2266V0.75V1.5H33.2109V0.75ZM23.2422 0.75V0H20.75V0.75V1.5H23.2422V0.75ZM20.75 0.75V0C19.8321 0 18.9278 0.059642 18.0408 0.175346L18.1378 0.919046L18.2348 1.66275C19.0577 1.55541 19.8972 1.5 20.75 1.5V0.75ZM13.0942 2.26761L12.807 1.57481C11.1196 2.27452 9.54493 3.19026 8.11732 4.28732L8.57432 4.88201L9.03131 5.4767C10.3562 4.45859 11.817 3.6092 13.3815 2.9604L13.0942 2.26761ZM4.88201 8.57431L4.28732 8.11732C3.19026 9.54492 2.27453 11.1196 1.57482 12.8069L2.26761 13.0942L2.96041 13.3815C3.60921 11.817 4.4586 10.3562 5.4767 9.03131L4.88201 8.57431ZM0.919046 18.1378L0.175346 18.0408C0.0596422 18.9278 0 19.8321 0 20.75H0.75H1.5C1.5 19.8972 1.55541 19.0577 1.66275 18.2348L0.919046 18.1378ZM0.75 20.75H0V23.2558H0.75H1.5V20.75H0.75ZM0.75 28.2674H0V33.2791H0.75H1.5V28.2674H0.75ZM0.75 38.2907H0V43.3023H0.75H1.5V38.2907H0.75ZM0.75 48.3139H0V53.3256H0.75H1.5V48.3139H0.75ZM0.75 58.3372H0V63.3488H0.75H1.5V58.3372H0.75ZM0.75 68.3605H0V73.3721H0.75H1.5V68.3605H0.75ZM0.75 78.3837H0V83.3953H0.75H1.5V78.3837H0.75ZM0.75 88.407H0V93.4186H0.75H1.5V88.407H0.75ZM0.75 98.4302H0V103.442H0.75H1.5V98.4302H0.75ZM0.75 108.453H0V113.465H0.75H1.5V108.453H0.75ZM0.75 118.477H0V123.488H0.75H1.5V118.477H0.75ZM0.75 128.5H0V133.512H0.75H1.5V128.5H0.75ZM0.75 138.523H0V143.535H0.75H1.5V138.523H0.75ZM0.75 148.546H0V153.558H0.75H1.5V148.546H0.75ZM0.75 158.57H0V163.581H0.75H1.5V158.57H0.75ZM0.75 168.593H0V173.605H0.75H1.5V168.593H0.75ZM0.75 178.616H0V183.628H0.75H1.5V178.616H0.75ZM0.75 188.64H0V193.651H0.75H1.5V188.64H0.75ZM0.75 198.663H0V203.674H0.75H1.5V198.663H0.75ZM0.75 208.686H0V213.698H0.75H1.5V208.686H0.75ZM0.75 218.709H0V223.721H0.75H1.5V218.709H0.75ZM0.75 228.733H0V233.744H0.75H1.5V228.733H0.75ZM0.75 238.756H0V243.767H0.75H1.5V238.756H0.75ZM0.75 248.779H0V253.791H0.75H1.5V248.779H0.75ZM0.75 258.802H0V263.814H0.75H1.5V258.802H0.75ZM0.75 268.826H0V273.837H0.75H1.5V268.826H0.75ZM0.75 278.849H0V283.86H0.75H1.5V278.849H0.75ZM0.75 288.872H0V293.884H0.75H1.5V288.872H0.75ZM0.75 298.895H0V303.907H0.75H1.5V298.895H0.75ZM0.75 308.919H0V313.93H0.75H1.5V308.919H0.75ZM0.75 318.942H0V323.953H0.75H1.5V318.942H0.75ZM0.75 328.965H0V333.977H0.75H1.5V328.965H0.75ZM0.75 338.988H0V344H0.75H1.5V338.988H0.75ZM0.75 349.012H0V354.023H0.75H1.5V349.012H0.75ZM0.75 359.035H0V364.046H0.75H1.5V359.035H0.75ZM0.75 369.058H0V374.07H0.75H1.5V369.058H0.75ZM0.75 379.081H0V384.093H0.75H1.5V379.081H0.75ZM0.75 389.105H0V394.116H0.75H1.5V389.105H0.75ZM0.75 399.128H0V404.139H0.75H1.5V399.128H0.75ZM0.75 409.151H0V414.163H0.75H1.5V409.151H0.75ZM0.75 419.174H0V424.186H0.75H1.5V419.174H0.75ZM0.75 429.198H0V434.209H0.75H1.5V429.198H0.75ZM0.75 439.221H0V444.233H0.75H1.5V439.221H0.75ZM0.75 449.244H0V451.75H0.75H1.5V449.244H0.75ZM0.75 451.75H0C0 452.668 0.059642 453.572 0.175346 454.459L0.919046 454.362L1.66275 454.265C1.55541 453.442 1.5 452.603 1.5 451.75H0.75ZM2.26761 459.406L1.57482 459.693C2.27452 461.38 3.19026 462.955 4.28732 464.383L4.88201 463.926L5.4767 463.469C4.45859 462.144 3.60921 460.683 2.9604 459.118L2.26761 459.406ZM8.57431 467.618L8.11732 468.213C9.54492 469.31 11.1196 470.225 12.8069 470.925L13.0942 470.232L13.3815 469.54C11.817 468.891 10.3562 468.041 9.03131 467.023L8.57431 467.618ZM18.1378 471.581L18.0408 472.325C18.9278 472.44 19.8321 472.5 20.75 472.5V471.75V471C19.8972 471 19.0577 470.945 18.2348 470.837L18.1378 471.581ZM20.75 471.75V472.5H23.2661V471.75V471H20.75V471.75ZM28.2984 471.75V472.5H33.3307V471.75V471H28.2984V471.75ZM38.3629 471.75V472.5H43.3952V471.75V471H38.3629V471.75ZM48.4275 471.75V472.5H53.4598V471.75V471H48.4275V471.75ZM58.492 471.75V472.5H63.5243V471.75V471H58.492V471.75ZM68.5566 471.75V472.5H73.5889V471.75V471H68.5566V471.75ZM78.6211 471.75V472.5H83.6534V471.75V471H78.6211V471.75ZM88.6857 471.75V472.5H93.718V471.75V471H88.6857V471.75ZM98.7502 471.75V472.5H103.783V471.75V471H98.7502V471.75ZM108.815 471.75V472.5H113.847V471.75V471H108.815V471.75ZM118.879 471.75V472.5H123.912V471.75V471H118.879V471.75ZM128.944 471.75V472.5H133.976V471.75V471H128.944V471.75ZM139.008 471.75V472.5H144.041V471.75V471H139.008V471.75ZM149.073 471.75V472.5H154.105V471.75V471H149.073V471.75ZM159.137 471.75V472.5H164.17V471.75V471H159.137V471.75ZM169.202 471.75V472.5H174.234V471.75V471H169.202V471.75ZM179.267 471.75V472.5H184.299V471.75V471H179.267V471.75ZM189.331 471.75V472.5H194.363V471.75V471H189.331V471.75ZM199.396 471.75V472.5H204.428V471.75V471H199.396V471.75ZM209.46 471.75V472.5H214.492V471.75V471H209.46V471.75ZM219.525 471.75V472.5H224.557V471.75V471H219.525V471.75ZM229.589 471.75V472.5H232.105V471.75V471H229.589V471.75ZM232.105 471.75V472.5C233.023 472.5 233.928 472.44 234.815 472.325L234.718 471.581L234.621 470.837C233.798 470.945 232.958 471 232.105 471V471.75ZM239.761 470.232L240.049 470.925C241.736 470.225 243.311 469.31 244.738 468.213L244.281 467.618L243.824 467.023C242.499 468.041 241.039 468.891 239.474 469.54L239.761 470.232ZM247.973 463.926L248.568 464.383C249.665 462.955 250.581 461.38 251.281 459.693L250.588 459.406L249.895 459.118C249.246 460.683 248.397 462.144 247.379 463.469L247.973 463.926ZM251.936 454.362L252.68 454.459C252.796 453.572 252.855 452.668 252.855 451.75H252.105H251.355C251.355 452.603 251.3 453.442 251.193 454.265L251.936 454.362ZM252.105 451.75H252.855V451.038H252.105H251.355V451.75H252.105ZM252.105 449.613H252.855V448.9H252.105H251.355V449.613H252.105ZM252.105 448.9H252.855C252.855 448.048 252.911 447.208 253.018 446.385L252.275 446.288L251.531 446.191C251.415 447.078 251.355 447.983 251.355 448.9H252.105ZM253.623 441.245L254.316 441.532C254.965 439.967 255.814 438.507 256.832 437.182L256.237 436.725L255.643 436.268C254.546 437.695 253.63 439.27 252.93 440.957L253.623 441.245ZM259.93 433.032L260.387 433.627C261.712 432.609 263.172 431.76 264.737 431.111L264.45 430.418L264.162 429.725C262.475 430.425 260.9 431.341 259.473 432.438L259.93 433.032ZM269.493 429.069L269.59 429.813C270.413 429.706 271.253 429.65 272.105 429.65V428.9V428.15C271.188 428.15 270.283 428.21 269.396 428.326L269.493 429.069ZM272.105 428.9V429.65H274.521V428.9V428.15H272.105V428.9ZM279.353 428.9V429.65H284.185V428.9V428.15H279.353V428.9ZM289.017 428.9V429.65H293.848V428.9V428.15H289.017V428.9ZM298.68 428.9V429.65H303.512V428.9V428.15H298.68V428.9ZM308.344 428.9V429.65H313.175V428.9V428.15H308.344V428.9ZM318.007 428.9V429.65H322.839V428.9V428.15H318.007V428.9ZM327.671 428.9V429.65H332.502V428.9V428.15H327.671V428.9ZM337.334 428.9V429.65H339.75V428.9V428.15H337.334V428.9ZM339.75 428.9V429.65C340.668 429.65 341.572 429.591 342.459 429.475L342.362 428.731L342.265 427.988C341.442 428.095 340.603 428.15 339.75 428.15V428.9ZM347.406 427.383L347.693 428.076C349.38 427.376 350.955 426.46 352.383 425.363L351.926 424.768L351.469 424.174C350.144 425.192 348.683 426.041 347.118 426.69L347.406 427.383ZM355.618 421.076L356.213 421.533C357.31 420.105 358.225 418.531 358.925 416.843L358.232 416.556L357.54 416.269C356.891 417.833 356.041 419.294 355.023 420.619L355.618 421.076ZM359.581 411.513L360.325 411.61C360.44 410.723 360.5 409.818 360.5 408.9H359.75H359C359 409.753 358.945 410.593 358.837 411.416L359.581 411.513ZM359.75 408.9H360.5V406.412H359.75H359V408.9H359.75ZM359.75 401.436H360.5V396.46H359.75H359V401.436H359.75ZM359.75 391.483H360.5V386.507H359.75H359V391.483H359.75ZM359.75 381.531H360.5V376.555H359.75H359V381.531H359.75ZM359.75 371.578H360.5V366.602H359.75H359V371.578H359.75ZM359.75 361.626H360.5V356.649H359.75H359V361.626H359.75ZM359.75 351.673H360.5V346.697H359.75H359V351.673H359.75ZM359.75 341.721H360.5V336.744H359.75H359V341.721H359.75ZM359.75 331.768H360.5V326.792H359.75H359V331.768H359.75ZM359.75 321.815H360.5V316.839H359.75H359V321.815H359.75ZM359.75 311.863H360.5V306.886H359.75H359V311.863H359.75ZM359.75 301.91H360.5V296.934H359.75H359V301.91H359.75ZM359.75 291.958H360.5V286.981H359.75H359V291.958H359.75ZM359.75 282.005H360.5V277.029H359.75H359V282.005H359.75ZM359.75 272.052H360.5V267.076H359.75H359V272.052H359.75ZM359.75 262.1H360.5V257.124H359.75H359V262.1H359.75ZM359.75 252.147H360.5V247.171H359.75H359V252.147H359.75ZM359.75 242.195H360.5V237.218H359.75H359V242.195H359.75ZM359.75 232.242H360.5V227.266H359.75H359V232.242H359.75ZM359.75 222.29H360.5V217.313H359.75H359V222.29H359.75ZM359.75 212.337H360.5V207.361H359.75H359V212.337H359.75ZM359.75 202.384H360.5V197.408H359.75H359V202.384H359.75ZM359.75 192.432H360.5V187.456H359.75H359V192.432H359.75ZM359.75 182.479H360.5V177.503H359.75H359V182.479H359.75ZM359.75 172.527H360.5V167.55H359.75H359V172.527H359.75ZM359.75 162.574H360.5V157.598H359.75H359V162.574H359.75ZM359.75 152.622H360.5V147.645H359.75H359V152.622H359.75ZM359.75 142.669H360.5V137.693H359.75H359V142.669H359.75ZM359.75 132.716H360.5V127.74H359.75H359V132.716H359.75ZM359.75 122.764H360.5V117.788H359.75H359V122.764H359.75ZM359.75 112.811H360.5V107.835H359.75H359V112.811H359.75ZM359.75 102.859H360.5V97.8824H359.75H359V102.859H359.75ZM359.75 92.9061H360.5V87.9298H359.75H359V92.9061H359.75ZM359.75 82.9536H360.5V77.9773H359.75H359V82.9536H359.75ZM359.75 73.001H360.5V68.0247H359.75H359V73.001H359.75ZM359.75 63.0484H360.5V58.0721H359.75H359V63.0484H359.75ZM359.75 53.0958H360.5V48.1195H359.75H359V53.0958H359.75ZM359.75 43.1432H360.5V38.167H359.75H359V43.1432H359.75ZM359.75 33.1907H360.5V28.2144H359.75H359V33.1907H359.75ZM359.75 23.2381H360.5V20.75H359.75H359V23.2381H359.75ZM359.75 20.75H360.5C360.5 19.8321 360.44 18.9278 360.325 18.0408L359.581 18.1378L358.837 18.2348C358.945 19.0577 359 19.8972 359 20.75H359.75ZM358.232 13.0942L358.925 12.807C358.225 11.1196 357.31 9.54493 356.213 8.11732L355.618 8.57432L355.023 9.03131C356.041 10.3562 356.891 11.817 357.54 13.3815L358.232 13.0942ZM351.926 4.88201L352.383 4.28732C350.955 3.19026 349.38 2.27452 347.693 1.57481L347.406 2.26761L347.118 2.9604C348.683 3.60921 350.144 4.4586 351.469 5.4767L351.926 4.88201ZM342.362 0.919045L342.459 0.175346C341.572 0.0596419 340.668 0 339.75 0V0.75V1.5C340.603 1.5 341.442 1.55541 342.265 1.66275L342.362 0.919045Z"
          fill="#E3F0FA"
        />
      </svg>
      <input
        ref={fileInputRef}
        type="file"
        accept={acceptedFormats.join(",")}
        onChange={handleFileInputChange}
        className={styles.fileInput}
        aria-label="העלאת תמונה לבדיקה"
      />
    <div className={styles.uploadContent}>
      <span className={styles.uploadText}>+ הוספת</span>
      <span className={styles.uploadText}>צילום מסך לבדיקה</span>
    </div>
    {showHelpButton && (
      <button 
        className={styles.helpButton}
        onClick={(e) => {
          e.stopPropagation();
          onHelpClick?.();
        }}
        aria-label="עזרה"
      >
        <svg 
          className={styles.helpIcon}
          width="26" 
          height="26" 
          viewBox="0 0 26 26" 
          fill="none" 
          xmlns="http://www.w3.org/2000/svg"
        >
          <path 
            d="M9.27167 9.16667C9.54596 8.38695 10.0873 7.72946 10.7999 7.31066C11.5126 6.89185 12.3504 6.73876 13.165 6.8785C13.9797 7.01823 14.7186 7.44178 15.2509 8.07412C15.7832 8.70645 16.0746 9.50678 16.0733 10.3333C16.0733 12.6667 12.5733 13.8333 12.5733 13.8333M12.6667 18.5H12.6783M24.3333 12.6667C24.3333 19.11 19.11 24.3333 12.6667 24.3333C6.22334 24.3333 1 19.11 1 12.6667C1 6.22334 6.22334 1 12.6667 1C19.11 1 24.3333 6.22334 24.3333 12.6667Z" 
            stroke="#E3F0FA" 
            strokeWidth="2" 
            strokeLinecap="round" 
            strokeLinejoin="round"
          />
        </svg>
        <span className={styles.helpText}>עזרה</span>
      </button>
    )}
    </div>
  );
}

