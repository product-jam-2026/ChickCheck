import React, { useRef, useState } from "react";
import styles from "./HomeImageUploadArea.module.css";

interface HomeImageUploadAreaProps {
  onImageSelect?: (file: File) => void;
  maxFileSize?: number; // in bytes
  acceptedFormats?: string[];
  onHelpClick?: () => void;
}

export default function HomeImageUploadArea({
  onImageSelect,
  maxFileSize = 10 * 1024 * 1024, // 10MB default
  acceptedFormats = ["image/jpeg", "image/png", "image/jpg"],
  onHelpClick,
}: HomeImageUploadAreaProps) {
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [isDragging, setIsDragging] = useState(false);

  const handleFileSelect = (file: File) => {
    if (file.size > maxFileSize) {
      alert(`הקובץ גדול מדי. גודל מקסימלי: ${maxFileSize / 1024 / 1024}MB`);
      return;
    }

    if (!acceptedFormats.includes(file.type)) {
      alert("פורמט הקובץ לא נתמך. אנא העלה תמונה בפורמט JPG או PNG");
      return;
    }

    onImageSelect?.(file);
  };

  const handleFileInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      handleFileSelect(file);
    }
  };

  const handleClick = () => {
    fileInputRef.current?.click();
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(true);
  };

  const handleDragLeave = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);

    const file = e.dataTransfer.files?.[0];
    if (file) {
      handleFileSelect(file);
    }
  };

  return (
    <div
      className={`${styles.homeImageUploadArea} ${
        isDragging ? styles.dragging : ""
      }`}
      onClick={handleClick}
      onDragOver={handleDragOver}
      onDragLeave={handleDragLeave}
      onDrop={handleDrop}
    >
      <svg
        className={styles.borderSvg}
        viewBox="0 0 360.5 472.5"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        preserveAspectRatio="none"
        aria-hidden="true"
      >
        <path
          d="M359.75 407.271C359.75 418.317 350.796 427.271 339.75 427.271H272.105C261.06 427.271 252.105 436.226 252.105 447.271V451.75C252.105 462.796 243.151 471.75 232.105 471.75H20.75C9.7043 471.75 0.75 462.796 0.75 451.75V20.75C0.75 9.7043 9.70431 0.75 20.75 0.75H339.75C350.796 0.75 359.75 9.70431 359.75 20.75V407.271Z"
          fill="#E3F0FA"
          fillOpacity="0.07"
        />
        <path
          d="M339.75 0.75V0H337.258V0.75V1.5H339.75V0.75ZM332.273 0.75V0H327.289V0.75V1.5H332.273V0.75ZM322.305 0.75V0H317.32V0.75V1.5H322.305V0.75ZM312.336 0.75V0H307.352V0.75V1.5H312.336V0.75ZM302.367 0.75V0H297.383V0.75V1.5H302.367V0.75ZM292.398 0.75V0H287.414V0.75V1.5H292.398V0.75ZM282.43 0.75V0H277.445V0.75V1.5H282.43V0.75ZM272.461 0.75V0H267.477V0.75V1.5H272.461V0.75ZM262.492 0.75V0H257.508V0.75V1.5H262.492V0.75ZM252.523 0.75V0H247.539V0.75V1.5H252.523V0.75ZM242.555 0.75V0H237.57V0.75V1.5H242.555V0.75ZM232.586 0.75V0H227.602V0.75V1.5H232.586V0.75ZM222.617 0.75V0H217.633V0.75V1.5H222.617V0.75ZM212.648 0.75V0H207.664V0.75V1.5H212.648V0.75ZM202.68 0.75V0H197.695V0.75V1.5H202.68V0.75ZM192.711 0.75V0H187.727V0.75V1.5H192.711V0.75ZM182.742 0.75V0H177.758V0.75V1.5H182.742V0.75ZM172.773 0.75V0H167.789V0.75V1.5H172.773V0.75ZM162.805 0.75V0H157.82V0.75V1.5H162.805V0.75ZM152.836 0.75V0H147.852V0.75V1.5H152.836V0.75ZM142.867 0.75V0H137.883V0.75V1.5H142.867V0.75ZM132.898 0.75V0H127.914V0.75V1.5H132.898V0.75ZM122.93 0.75V0H117.945V0.75V1.5H122.93V0.75ZM112.961 0.75V0H107.977V0.75V1.5H112.961V0.75ZM102.992 0.75V0H98.0078V0.75V1.5H102.992V0.75ZM93.0234 0.75V0H88.0391V0.75V1.5H93.0234V0.75ZM83.0547 0.75V0H78.0703V0.75V1.5H83.0547V0.75ZM73.0859 0.75V0H68.1016V0.75V1.5H73.0859V0.75ZM63.1172 0.75V0H58.1328V0.75V1.5H63.1172V0.75ZM53.1484 0.75V0H48.1641V0.75V1.5H53.1484V0.75ZM43.1797 0.75V0H38.1953V0.75V1.5H43.1797V0.75ZM33.2109 0.75V0H28.2266V0.75V1.5H33.2109V0.75ZM23.2422 0.75V0H20.75V0.75V1.5H23.2422V0.75ZM20.75 0.75V0C19.8321 0 18.9278 0.059642 18.0408 0.175346L18.1378 0.919046L18.2348 1.66275C19.0577 1.55541 19.8972 1.5 20.75 1.5V0.75ZM13.0942 2.26761L12.807 1.57481C11.1196 2.27452 9.54493 3.19026 8.11732 4.28732L8.57432 4.88201L9.03131 5.4767C10.3562 4.45859 11.817 3.6092 13.3815 2.9604L13.0942 2.26761ZM4.88201 8.57431L4.28732 8.11732C3.19026 9.54492 2.27453 11.1196 1.57482 12.8069L2.26761 13.0942L2.96041 13.3815C3.60921 11.817 4.4586 10.3562 5.4767 9.03131L4.88201 8.57431ZM0.919046 18.1378L0.175346 18.0408C0.0596422 18.9278 0 19.8321 0 20.75H0.75H1.5C1.5 19.8972 1.55541 19.0577 1.66275 18.2348L0.919046 18.1378ZM0.75 20.75H0V23.2558H0.75H1.5V20.75H0.75ZM0.75 28.2674H0V33.2791H0.75H1.5V28.2674H0.75ZM0.75 38.2907H0V43.3023H0.75H1.5V38.2907H0.75ZM0.75 48.3139H0V53.3256H0.75H1.5V48.3139H0.75ZM0.75 58.3372H0V63.3488H0.75H1.5V58.3372H0.75ZM0.75 68.3605H0V73.3721H0.75H1.5V68.3605H0.75ZM0.75 78.3837H0V83.3953H0.75H1.5V78.3837H0.75ZM0.75 88.407H0V93.4186H0.75H1.5V88.407H0.75ZM0.75 98.4302H0V103.442H0.75H1.5V98.4302H0.75ZM0.75 108.453H0V113.465H0.75H1.5V108.453H0.75ZM0.75 118.477H0V123.488H0.75H1.5V118.477H0.75ZM0.75 128.5H0V133.512H0.75H1.5V128.5H0.75ZM0.75 138.523H0V143.535H0.75H1.5V138.523H0.75ZM0.75 148.546H0V153.558H0.75H1.5V148.546H0.75ZM0.75 158.57H0V163.581H0.75H1.5V158.57H0.75ZM0.75 168.593H0V173.605H0.75H1.5V168.593H0.75ZM0.75 178.616H0V183.628H0.75H1.5V178.616H0.75ZM0.75 188.64H0V193.651H0.75H1.5V188.64H0.75ZM0.75 198.663H0V203.674H0.75H1.5V198.663H0.75ZM0.75 208.686H0V213.698H0.75H1.5V208.686H0.75ZM0.75 218.709H0V223.721H0.75H1.5V218.709H0.75ZM0.75 228.733H0V233.744H0.75H1.5V228.733H0.75ZM0.75 238.756H0V243.767H0.75H1.5V238.756H0.75ZM0.75 248.779H0V253.791H0.75H1.5V248.779H0.75ZM0.75 258.802H0V263.814H0.75H1.5V258.802H0.75ZM0.75 268.826H0V273.837H0.75H1.5V268.826H0.75ZM0.75 278.849H0V283.86H0.75H1.5V278.849H0.75ZM0.75 288.872H0V293.884H0.75H1.5V288.872H0.75ZM0.75 298.895H0V303.907H0.75H1.5V298.895H0.75ZM0.75 308.919H0V313.93H0.75H1.5V308.919H0.75ZM0.75 318.942H0V323.953H0.75H1.5V318.942H0.75ZM0.75 328.965H0V333.977H0.75H1.5V328.965H0.75ZM0.75 338.988H0V344H0.75H1.5V338.988H0.75ZM0.75 349.012H0V354.023H0.75H1.5V349.012H0.75ZM0.75 359.035H0V364.046H0.75H1.5V359.035H0.75ZM0.75 369.058H0V374.07H0.75H1.5V369.058H0.75ZM0.75 379.081H0V384.093H0.75H1.5V379.081H0.75ZM0.75 389.105H0V394.116H0.75H1.5V389.105H0.75ZM0.75 399.128H0V404.139H0.75H1.5V399.128H0.75ZM0.75 409.151H0V414.163H0.75H1.5V409.151H0.75ZM0.75 419.174H0V424.186H0.75H1.5V419.174H0.75ZM0.75 429.198H0V434.209H0.75H1.5V429.198H0.75ZM0.75 439.221H0V444.233H0.75H1.5V439.221H0.75ZM0.75 449.244H0V451.75H0.75H1.5V449.244H0.75ZM0.75 451.75H0C0 452.668 0.059642 453.572 0.175346 454.459L0.919046 454.362L1.66275 454.265C1.55541 453.442 1.5 452.603 1.5 451.75H0.75ZM2.26761 459.406L1.57482 459.693C2.27452 461.38 3.19026 462.955 4.28732 464.383L4.88201 463.926L5.4767 463.469C4.45859 462.144 3.60921 460.683 2.9604 459.118L2.26761 459.406ZM8.57431 467.618L8.11732 468.213C9.54492 469.31 11.1196 470.225 12.8069 470.925L13.0942 470.232L13.3815 469.54C11.817 468.891 10.3562 468.041 9.03131 467.023L8.57431 467.618ZM18.1378 471.581L18.0408 472.325C18.9278 472.44 19.8321 472.5 20.75 472.5V471.75V471C19.8972 471 19.0577 470.945 18.2348 470.837L18.1378 471.581ZM20.75 471.75V472.5H23.2661V471.75V471H20.75V471.75ZM28.2984 471.75V472.5H33.3307V471.75V471H28.2984V471.75ZM38.3629 471.75V472.5H43.3952V471.75V471H38.3629V471.75ZM48.4275 471.75V472.5H53.4598V471.75V471H48.4275V471.75ZM58.492 471.75V472.5H63.5243V471.75V471H58.492V471.75ZM68.5566 471.75V472.5H73.5889V471.75V471H68.5566V471.75ZM78.6211 471.75V472.5H83.6534V471.75V471H78.6211V471.75ZM88.6857 471.75V472.5H93.718V471.75V471H88.6857V471.75ZM98.7502 471.75V472.5H103.783V471.75V471H98.7502V471.75ZM108.815 471.75V472.5H113.847V471.75V471H108.815V471.75ZM118.879 471.75V472.5H123.912V471.75V471H118.879V471.75ZM128.944 471.75V472.5H133.976V471.75V471H128.944V471.75ZM139.008 471.75V472.5H144.041V471.75V471H139.008V471.75ZM149.073 471.75V472.5H154.105V471.75V471H149.073V471.75ZM159.137 471.75V472.5H164.17V471.75V471H159.137V471.75ZM169.202 471.75V472.5H174.234V471.75V471H169.202V471.75ZM179.267 471.75V472.5H184.299V471.75V471H179.267V471.75ZM189.331 471.75V472.5H194.363V471.75V471H189.331V471.75ZM199.396 471.75V472.5H204.428V471.75V471H199.396V471.75ZM209.46 471.75V472.5H214.492V471.75V471H209.46V471.75ZM219.525 471.75V472.5H224.557V471.75V471H219.525V471.75ZM229.589 471.75V472.5H232.105V471.75V471H229.589V471.75ZM232.105 471.75V472.5C233.023 472.5 233.928 472.44 234.815 472.325L234.718 471.581L234.621 470.837C233.798 470.945 232.958 471 232.105 471V471.75ZM239.761 470.232L240.049 470.925C241.736 470.225 243.311 469.31 244.738 468.213L244.281 467.618L243.824 467.023C242.499 468.041 241.039 468.891 239.474 469.54L239.761 470.232ZM247.973 463.926L248.568 464.383C249.665 462.955 250.581 461.38 251.281 459.693L250.588 459.406L249.895 459.118C249.246 460.683 248.397 462.144 247.379 463.469L247.973 463.926ZM251.936 454.362L252.68 454.459C252.796 453.572 252.855 452.668 252.855 451.75H252.105H251.355C251.355 452.603 251.3 453.442 251.193 454.265L251.936 454.362ZM252.105 451.75H252.855V450.63H252.105H251.355V451.75H252.105ZM252.105 448.391H252.855V447.271H252.105H251.355V448.391H252.105ZM252.105 447.271H252.855C252.855 446.419 252.911 445.579 253.018 444.756L252.275 444.659L251.531 444.562C251.415 445.449 251.355 446.354 251.355 447.271H252.105ZM253.623 439.616L254.316 439.903C254.965 438.338 255.814 436.878 256.832 435.553L256.237 435.096L255.643 434.639C254.546 436.066 253.63 437.641 252.93 439.328L253.623 439.616ZM259.93 431.404L260.387 431.998C261.712 430.98 263.172 430.131 264.737 429.482L264.45 428.789L264.162 428.096C262.475 428.796 260.9 429.712 259.473 430.809L259.93 431.404ZM269.493 427.441L269.59 428.184C270.413 428.077 271.253 428.021 272.105 428.021V427.271V426.521C271.188 426.521 270.283 426.581 269.396 426.697L269.493 427.441ZM272.105 427.271V428.021H274.521V427.271V426.521H272.105V427.271ZM279.353 427.271V428.021H284.185V427.271V426.521H279.353V427.271ZM289.017 427.271V428.021H293.848V427.271V426.521H289.017V427.271ZM298.68 427.271V428.021H303.512V427.271V426.521H298.68V427.271ZM308.344 427.271V428.021H313.175V427.271V426.521H308.344V427.271ZM318.007 427.271V428.021H322.839V427.271V426.521H318.007V427.271ZM327.671 427.271V428.021H332.502V427.271V426.521H327.671V427.271ZM337.334 427.271V428.021H339.75V427.271V426.521H337.334V427.271ZM339.75 427.271V428.021C340.668 428.021 341.572 427.962 342.459 427.846L342.362 427.102L342.265 426.359C341.442 426.466 340.603 426.521 339.75 426.521V427.271ZM347.406 425.754L347.693 426.447C349.38 425.747 350.955 424.831 352.383 423.734L351.926 423.139L351.469 422.545C350.144 423.563 348.683 424.412 347.118 425.061L347.406 425.754ZM355.618 419.447L356.213 419.904C357.31 418.477 358.225 416.902 358.925 415.215L358.232 414.927L357.54 414.64C356.891 416.205 356.041 417.665 355.023 418.99L355.618 419.447ZM359.581 409.884L360.325 409.981C360.44 409.094 360.5 408.189 360.5 407.271H359.75H359C359 408.124 358.945 408.964 358.837 409.787L359.581 409.884ZM359.75 407.271H360.5V404.794H359.75H359V407.271H359.75ZM359.75 399.838H360.5V394.883H359.75H359V399.838H359.75ZM359.75 389.928H360.5V384.972H359.75H359V389.928H359.75ZM359.75 380.017H360.5V375.061H359.75H359V380.017H359.75ZM359.75 370.106H360.5V365.151H359.75H359V370.106H359.75ZM359.75 360.195H360.5V355.24H359.75H359V360.195H359.75ZM359.75 350.284H360.5V345.329H359.75H359V350.284H359.75ZM359.75 340.374H360.5V335.418H359.75H359V340.374H359.75ZM359.75 330.463H360.5V325.507H359.75H359V330.463H359.75ZM359.75 320.552H360.5V315.596H359.75H359V320.552H359.75ZM359.75 310.641H360.5V305.686H359.75H359V310.641H359.75ZM359.75 300.73H360.5V295.775H359.75H359V300.73H359.75ZM359.75 290.819H360.5V285.864H359.75H359V290.819H359.75ZM359.75 280.909H360.5V275.953H359.75H359V280.909H359.75ZM359.75 270.998H360.5V266.042H359.75H359V270.998H359.75ZM359.75 261.087H360.5V256.132H359.75H359V261.087H359.75ZM359.75 251.176H360.5V246.221H359.75H359V251.176H359.75ZM359.75 241.265H360.5V236.31H359.75H359V241.265H359.75ZM359.75 231.355H360.5V226.399H359.75H359V231.355H359.75ZM359.75 221.444H360.5V216.488H359.75H359V221.444H359.75ZM359.75 211.533H360.5V206.578H359.75H359V211.533H359.75ZM359.75 201.622H360.5V196.667H359.75H359V201.622H359.75ZM359.75 191.711H360.5V186.756H359.75H359V191.711H359.75ZM359.75 181.801H360.5V176.845H359.75H359V181.801H359.75ZM359.75 171.89H360.5V166.934H359.75H359V171.89H359.75ZM359.75 161.979H360.5V157.024H359.75H359V161.979H359.75ZM359.75 152.068H360.5V147.113H359.75H359V152.068H359.75ZM359.75 142.157H360.5V137.202H359.75H359V142.157H359.75ZM359.75 132.247H360.5V127.291H359.75H359V132.247H359.75ZM359.75 122.336H360.5V117.38H359.75H359V122.336H359.75ZM359.75 112.425H360.5V107.47H359.75H359V112.425H359.75ZM359.75 102.514H360.5V97.5588H359.75H359V102.514H359.75ZM359.75 92.6033H360.5V87.6479H359.75H359V92.6033H359.75ZM359.75 82.6925H360.5V77.7371H359.75H359V82.6925H359.75ZM359.75 72.7817H360.5V67.8263H359.75H359V72.7817H359.75ZM359.75 62.8709H360.5V57.9154H359.75H359V62.8709H359.75ZM359.75 52.96H360.5V48.0046H359.75H359V52.96H359.75ZM359.75 43.0492H360.5V38.0938H359.75H359V43.0492H359.75ZM359.75 33.1384H360.5V28.1829H359.75H359V33.1384H359.75ZM359.75 23.2275H360.5V20.75H359.75H359V23.2275H359.75ZM359.75 20.75H360.5C360.5 19.8321 360.44 18.9278 360.325 18.0408L359.581 18.1378L358.837 18.2348C358.945 19.0577 359 19.8972 359 20.75H359.75ZM358.232 13.0942L358.925 12.807C358.225 11.1196 357.31 9.54493 356.213 8.11732L355.618 8.57432L355.023 9.03131C356.041 10.3562 356.891 11.817 357.54 13.3815L358.232 13.0942ZM351.926 4.88201L352.383 4.28732C350.955 3.19026 349.38 2.27452 347.693 1.57481L347.406 2.26761L347.118 2.9604C348.683 3.60921 350.144 4.4586 351.469 5.4767L351.926 4.88201ZM342.362 0.919045L342.459 0.175346C341.572 0.0596419 340.668 0 339.75 0V0.75V1.5C340.603 1.5 341.442 1.55541 342.265 1.66274L342.362 0.919045Z"
          fill="#E3F0FA"
        />
      </svg>
      <input
        ref={fileInputRef}
        type="file"
        accept={acceptedFormats.join(",")}
        onChange={handleFileInputChange}
        className={styles.fileInput}
        aria-label="העלאת תמונה לבדיקה"
      />
    <div className={styles.uploadContent}>
      <span className={styles.uploadText}>+ הוספת</span>
      <span className={styles.uploadText}>צילום מסך לבדיקה</span>
    </div>
    <button 
      className={styles.helpButton}
      onClick={(e) => {
        e.stopPropagation();
        onHelpClick?.();
      }}
      aria-label="עזרה"
    >
      <svg 
        className={styles.helpIcon}
        width="26" 
        height="26" 
        viewBox="0 0 26 26" 
        fill="none" 
        xmlns="http://www.w3.org/2000/svg"
      >
        <path 
          d="M9.27167 9.16667C9.54596 8.38695 10.0873 7.72946 10.7999 7.31066C11.5126 6.89185 12.3504 6.73876 13.165 6.8785C13.9797 7.01823 14.7186 7.44178 15.2509 8.07412C15.7832 8.70645 16.0746 9.50678 16.0733 10.3333C16.0733 12.6667 12.5733 13.8333 12.5733 13.8333M12.6667 18.5H12.6783M24.3333 12.6667C24.3333 19.11 19.11 24.3333 12.6667 24.3333C6.22334 24.3333 1 19.11 1 12.6667C1 6.22334 6.22334 1 12.6667 1C19.11 1 24.3333 6.22334 24.3333 12.6667Z" 
          stroke="#E3F0FA" 
          strokeWidth="2" 
          strokeLinecap="round" 
          strokeLinejoin="round"
        />
      </svg>
      <span className={styles.helpText}>עזרה</span>
    </button>
    </div>
  );
}

